<!DOCTYPE html> <html lang="en"> <head> <title>Getting started with Hibernate Search - Hibernate Search</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/2.3.1.3/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="../../../stylesheets/styles.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/images/hibernate/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-logo.png); background-repeat:no-repeat; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 200px; margin: 0px auto; }
      }
    </style> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <div id="subproject"> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div id="logobar"> <div class="dropup"> <a class="tabnav-closed" href="https://www.jboss.org" id="tab">Red Hat</a> <script>
              window.addEventListener('load', function() { renderTabzilla("Hibernate Search","search") }, false);
            </script> </div> <a href="/"> <img src="http://static.jboss.org/hibernate/images/hibernate_logo_whitebkg_200px.png"> </a> </div> <div class="navbar navbar-inverse"> <div class="navbar-inner"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <ul class="nav pull-left"> <li class=""><a href="/orm/">ORM</a></li> <li class="active"><a href="/search/">Search</a></li> <li class=""><a href="/validator/">Validator</a></li> <li class=""><a href="/ogm/">OGM</a></li> <li class=""><a href="/tools/">Tools</a></li> <li class=""><a href="/others/">Others</a></li> </ul> <ul class="nav pull-right"> <li><a href="http://in.relation.to">Blog</a></li> <li class=""><a href="../../../community">Community</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">Follow Us <b class="caret"></b></a> <ul class="dropdown-menu projectsocialmedia"> <li><a href="https://twitter.com/hibernate"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_twitter.png"></a></li> <li><a href="https://plus.google.com/112681342290762837955/posts"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_googleplus.png"></a></li> </ul> </li> </ul> </div> </div> </div> <script>
          var displayed_releases = [];
          displayed_releases.push('5.8.0.CR1');
          displayed_releases.push('5.7.1.Final');
          displayed_releases.push('5.6.2.Final');
          displayed_releases.push('5.5.7.Final');
        </script> <div class="row-fluid"> <div class="span2"> <div class="project-menu"> <div class="text-center project-menu-title"> <span class="icon-stack"> <i class="icon-circle icon-stack-base icon-fixed-width"></i> <i class="icon icon-light icon-fixed-width icon-search"></i> </span> </div> <ul class="nav nav-list"> <li class=""> <a href="../.."> <i class="icon-fixed-width icon-home menu-icon"></i> About </a> </li> <li class=""> <a href="../../downloads"> <i class="icon-fixed-width icon-cloud-download menu-icon"></i> Downloads </a> </li> <li class="active"> <a href=".."> <i class="icon-fixed-width icon-book menu-icon"></i> Documentation </a> </li> <li class=""> <a href="../../tooling"> <i class="icon-fixed-width icon-wrench menu-icon"></i> Tooling </a> </li> <li class=""> <a href="../../support"> <i class="icon-fixed-width icon-user-md menu-icon"></i> Paid support </a> </li> <li class=""> <a href="../../faq"> <i class="icon-fixed-width icon-question menu-icon"></i> FAQ </a> </li> <li class=""> <a href="../../roadmap"> <i class="icon-fixed-width icon-road menu-icon"></i> Roadmap </a> </li> <li class=""> <a href="../../contribute"> <i class="icon-fixed-width icon-beer menu-icon"></i> Contribute </a> </li> <li class="divider"></li> <li> <a href="https://community.jboss.org/en/hibernate/search"> <i class="icon-fixed-width icon-edit menu-icon"></i> Wiki </a> </li> <li> <a href="https://hibernate.atlassian.net/browse/HSEARCH"> <i class="icon-fixed-width icon-exclamation-sign menu-icon"></i> Issues </a> </li> <li> <a href="https://access.redhat.com/security/team/contact/"> <i class="icon-fixed-width icon-lock menu-icon"></i> Security issue </a> </li> <li> <a href="https://forum.hibernate.org/viewforum.php?f=9"> <i class="icon-fixed-width icon-comments menu-icon"></i> Forum </a> </li> <li> <a href="https://github.com/hibernate/hibernate-search"> <i class="icon-fixed-width icon-code menu-icon"></i> Source code </a> </li> <li> <a href="http://ci.hibernate.org/job/hibernate-search-master/"> <i class="icon-fixed-width icon-stethoscope menu-icon"></i> CI </a> </li> </ul> </div> <hr class="divider"> <div class="license text-center"> Released under the <a href="https://raw.github.com/hibernate/hibernate-search/master/lgpl.txt">LGPL v2.1</a> </div> </div> <div class="span10"> <div class="row-fluid"> <div class="visible-desktop project-title-desktop"> <div class="pull-left"> <h1>Getting started with Hibernate Search</h1> </div> </div> <div class="hidden-desktop"> <div class="project-title-phone text-center"> <div> <h1>Getting started with Hibernate Search</h1> </div> </div> </div> </div> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Welcome to Hibernate Search. The following chapter will guide you through the initial steps required to integrate Hibernate Search into an existing Hibernate enabled application. In case you are a new to Hibernate we recommend you start from <a href="http://hibernate.org/quick-start.html">here</a>.</p> </div> </div> <div id="toc" class="toc"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#system-requirements">System requirements</a> <ul class="sectlevel2"> <li><a href="#using-maven">Using Maven</a></li> </ul> </li> <li><a href="#configuration">Configuration</a> <ul class="sectlevel2"> <li><a href="#enable-full-text-search-capabilities-on-your-entities">Enable full-text search capabilities on your Entities</a> <ul class="sectlevel3"> <li><a href="#define-which-entities-need-to-be-indexed">Define which entities need to be indexed</a></li> <li><a href="#pick-a-unique-identifier">Pick a unique identifier</a></li> <li><a href="#choose-what-to-index-and-how">Choose what to index, and how</a></li> <li><a href="#store-option-and-projections">Store option and Projections</a></li> <li><a href="#some-types-might-need-encoding">Some types might need encoding</a></li> <li><a href="#indexing-of-associated-entities">Indexing of associated entities</a></li> <li><a href="#more-advanced-models">More advanced models</a></li> </ul> </li> </ul> </li> <li><a href="#indexing">Indexing</a></li> <li><a href="#searching">Searching</a></li> <li><a href="#introduction-to-full-text">Introduction to Full-Text</a></li> <li><a href="#what-s-next">What&#8217;s next</a></li> </ul> </div> </div> <div class="sect1"> <h2 id="system-requirements"><a class="anchor" href="#system-requirements"></a>System requirements</h2> <div class="sectionbody"> <div class="dlist"> <dl> <dt class="hdlist1">Java Runtime</dt> <dd> <p>To use the latest Hibernate Search version (5.7.1.Final) you&#8217;ll need Java version 8 or greater. You can download a Java Runtime for Windows/Linux/Solaris <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a>.</p> </dd> <dt class="hdlist1">Hibernate Search</dt> <dd> <p>hibernate-search-5.7.1.Final.jar and all runtime dependencies. You can get the jar artifacts either from the <em>dist/lib</em> directory of the Hibernate Search distribution or you can download them from the Maven central repository.</p> </dd> <dt class="hdlist1">Hibernate ORM</dt> <dd> <p>You will need hibernate-core-5.2.8.Final.jar and its transitive dependencies (either from <a href="http://sourceforge.net/projects/hibernate/files/hibernate4/5.2.8.Final/">Sourceforge</a> or the Maven central repository).</p> </dd> <dt class="hdlist1">JPA 2.1</dt> <dd> <p>Even though Hibernate Search can be used without needing JPA annotations the following instructions will use them for basic entity configuration (<em>@Entity, @Id, @OneToMany,&#8230;&#8203;</em>). This part of the configuration could also be expressed in xml or code. Hibernate Search has its own set of annotations (<em>@Indexed, @DocumentId, @Field,&#8230;&#8203;</em>) for which there exists so far no XML based alternative; if annotations aren&#8217;t suited for your project, a better option is the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#hsearch-mapping-programmaticapi">Programmatic Mapping API</a>.</p> </dd> </dl> </div> <div class="paragraph"> <p>If you can&#8217;t upgrade beyond Java 7, you can use Hibernate Search versions 5.6.x. People on Java 6 should look at the older versions of Hibernate Search 4.x. For Java 5, you can use Hibernate Search 3.x.</p> </div> <div class="sect2"> <h3 id="using-maven"><a class="anchor" href="#using-maven"></a>Using Maven</h3> <div class="paragraph"> <p>The Hibernate Search artifacts can be found in Maven&#8217;s central repository but are released first in the JBoss Maven repository. To make sure you always get the latest updates in a timaly manner we suggest to add this repository to your global settings.xml file (see also <a href="https://community.jboss.org/wiki/MavenGettingStarted-Users">Maven Getting Started</a> for more details).</p> </div> <div class="paragraph"> <p>This is all you need to add to your pom.xml to get started:</p> </div> <div class="listingblock"> <div class="title">Maven artifact identifier for Hibernate Search</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.hibernate<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>hibernate-search-orm<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;version&gt;</span>5.7.1.Final<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>&#x000A;<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="listingblock"> <div class="title">Optional: to store indexes in Infinispan</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.hibernate<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>hibernate-search-infinispan<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;version&gt;</span>5.7.1.Final<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>&#x000A;<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="listingblock"> <div class="title">Optional: to store indexes in Elasticsearch</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.hibernate<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>hibernate-search-elasticsearch<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070;font-weight:bold">&lt;version&gt;</span>5.7.1.Final<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>&#x000A;<span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Some of the dependencies of <em>hibernate-search-infinispan</em> might require to enable the the JBoss Maven repository. See the <a href="https://community.jboss.org/wiki/MavenGettingStarted-Users">Maven Getting Started</a> on how to configure your local Maven settings.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>The next step is to add a couple of properties to your Hibernate configuration file. If you are using Hibernate directly this can be done in hibernate.properties or hibernate.cfg.xml; if you are using Hibernate via JPA you can add these same properties to persistence.xml.</p> </div> <div class="paragraph"> <p>Most configuration settings have reasonable defaults: to get started you don&#8217;t need to add any property.</p> </div> <div class="paragraph"> <p>An example configuration could look like this:</p> </div> <div class="listingblock"> <div class="title">To store the indexes on filesystem, on a specific path:</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="xml">...&#x000A;<span style="color:#070;font-weight:bold">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">hibernate.search.default.directory_provider</span><span style="color:#710">&quot;</span></span>&#x000A;          <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">filesystem</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>&#x000A;&#x000A;<span style="color:#070;font-weight:bold">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">hibernate.search.default.indexBase</span><span style="color:#710">&quot;</span></span>&#x000A;          <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/var/lucene/indexes</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>&#x000A;...</code></pre> </div> </div> <div class="paragraph"> <p>First you have to tell Hibernate Search which DirectoryProvider to use. This can be achieved by setting the hibernate.search.default.directory_provider property. Apache Lucene has the notion of a Directory to store the index files. Hibernate Search handles the initialization and configuration of a Lucene Directory instance via a DirectoryProvider. In this tutorial we will use a a directory provider storing the index on the file system. This will give us the ability to inspect the Lucene indexes created by Hibernate Search (eg via <a href="https://github.com/DmitryKey/luke/releases/">Luke</a>). See <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration-directory">Directory Configuration</a> to configure different Directory implementations.</p> </div> <div class="paragraph"> <p>When using the <em>filesystem</em> DirectoryProvider you also have to specify the default base directory for all indexes via the property hibernate.search.default.indexBase.</p> </div> <div class="paragraph"> <p>Let&#8217;s assume that your application contains the Hibernate managed classes example.Book and example.Author and you want to add free text search capabilities to your application in order to search the books contained in your database.</p> </div> <div class="listingblock"> <div class="title">Example entities Book and Author before adding Hibernate Search specific annotations</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Book</span>() {}&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Author</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> name;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> Author() {}&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="sect2"> <h3 id="enable-full-text-search-capabilities-on-your-entities"><a class="anchor" href="#enable-full-text-search-capabilities-on-your-entities"></a>Enable full-text search capabilities on your Entities</h3> <div class="paragraph"> <p>To achieve this you have to add a few annotations to the Book and Author class:</p> </div> <div class="sect3"> <h4 id="define-which-entities-need-to-be-indexed"><a class="anchor" href="#define-which-entities-need-to-be-indexed"></a>Define which entities need to be indexed</h4> <div class="paragraph"> <p>The annotation @Indexed marks <em>Book</em> as an entity which needs to be indexed by Hibernate Search.</p> </div> </div> <div class="sect3"> <h4 id="pick-a-unique-identifier"><a class="anchor" href="#pick-a-unique-identifier"></a>Pick a unique identifier</h4> <div class="paragraph"> <p>Hibernate Search needs to store the entity identifier in the index for each entity. By default, it will use for this purpose the field marked with @Id but you can override this using @DocumentId (advanced users only).</p> </div> </div> <div class="sect3"> <h4 id="choose-what-to-index-and-how"><a class="anchor" href="#choose-what-to-index-and-how"></a>Choose what to index, and how</h4> <div class="paragraph"> <p>Next you have to mark the fields you want to make searchable. Let&#8217;s start with title and subtitle and annotate both with @Field.</p> </div> <div class="paragraph"> <p>The parameter index=Index.YES will ensure that the text will be indexed, while analyze=Analyze.YES ensures that the text will be analyzed using the default Lucene analyzer.</p> </div> <div class="paragraph"> <p>Analyzer options are important concept that we will better explain in the reference documentation. For the purpose of a simple introduction, let&#8217;s simplify and say that analyzing means chunking a sentence into individual words, lowercase them and potentially excluding common words like <em>'a'</em> or <em>'the'</em>.</p> </div> </div> <div class="sect3"> <h4 id="store-option-and-projections"><a class="anchor" href="#store-option-and-projections"></a>Store option and Projections</h4> <div class="paragraph"> <p>The third parameter, store=Store.NO, ensures that the actual data will not be stored in the index. Whether this data is stored in the index or not has nothing to do with the ability to search for it: the benefit of storing it is the ability to retrieve it via projections (see <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#projections">Projections</a>).</p> </div> <div class="paragraph"> <p>When not using projections Hibernate Search will execute a Lucene query in order to find the database identifiers of the entities matching the query and use these identifiers to retrieve managed objects from the database. If you use projections you might avoid the roundtrip to the database, but this will only return object arrays and not the managed objects you get from a normal query.</p> </div> <div class="paragraph"> <p>Note that index=Index.YES, analyze=Analyze.YES and store=Store.NO are the default values for these parameters and could be omitted.</p> </div> </div> <div class="sect3"> <h4 id="some-types-might-need-encoding"><a class="anchor" href="#some-types-might-need-encoding"></a>Some types might need encoding</h4> <div class="paragraph"> <p>The Lucene index is mostly string based, with some additional support for numeric types. For this reason Hibernate Search must convert the data types of the indexed fields to strings and vice versa. The exception are those properties like <em>Integer</em>, <em>Long</em>, <em>Calendar</em>.. these are all indexed as <em>NumericField</em> which means they will be encoded in a representation more suited for range queries.</p> </div> <div class="paragraph"> <p>Many predefined bridges are provided, for example the BooleanBridge will encode properties of type Boolean to literals "true" or "false"; by so doing they are searchable by keyword.</p> </div> <div class="paragraph"> <p>In the case of our example, the <em>Book</em> entity has a Date property so if we want to make this property searchable too, we will need to annotate it with both @Field and @DateBridge.</p> </div> <div class="paragraph"> <p>For more details see <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-mapping-bridge">Bridges</a>.</p> </div> </div> <div class="sect3"> <h4 id="indexing-of-associated-entities"><a class="anchor" href="#indexing-of-associated-entities"></a>Indexing of associated entities</h4> <div class="paragraph"> <p>The @IndexedEmbedded annotation is used to index associated entities, like those normally defined via @ManyToMany, @OneToOne, @ManyToOne, @Embedded and @ElementCollection.</p> </div> <div class="paragraph"> <p>Note however that the properties of the associated entities are embedded in the same index entry of the entity being marked with @Indexed, essentially denormalizing the data. This is needed since a Lucene index document is a flat data structure which is not suited to store relational information.</p> </div> <div class="paragraph"> <p>In our example, to ensure that the author&#8217;s name will be searchable you have to make sure that the names are indexed as part of the book itself. On top of @IndexedEmbedded you will also have to mark all fields of the associated entity you want to have included in the index with @Indexed. For more details see <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-mapping-associated">Embedded and Associated Objects</a>.</p> </div> </div> <div class="sect3"> <h4 id="more-advanced-models"><a class="anchor" href="#more-advanced-models"></a>More advanced models</h4> <div class="paragraph"> <p>These are all annotations you need to know about for our quickstart. For more details on entity mapping refer to <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-mapping-entity">Mapping an Entity</a>.</p> </div> <div class="listingblock"> <div class="title">Example entities after adding Hibernate Search annotations</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#007">@Indexed</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index=Index.YES, analyze=Analyze.YES, store=Store.NO)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index=Index.YES, analyze=Analyze.YES, store=Store.NO)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index=Index.YES, analyze=Analyze.NO, store=Store.YES)&#x000A;  <span style="color:#007">@DateBridge</span>(resolution=Resolution.DAY)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#007">@IndexedEmbedded</span>&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Book</span>() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Author</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> name;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> Author() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="indexing"><a class="anchor" href="#indexing"></a>Indexing</h2> <div class="sectionbody"> <div class="paragraph"> <p>The short answer is that indexing is automatic: Hibernate Search will transparently index every entity each time it&#8217;s persisted, updated or removed through Hibernate ORM. Its mission is to keep the index and your database in sync, allowing you to forget about this problem.</p> </div> <div class="paragraph"> <p>However, when introducing Hibernate Search in an existing application, you have to create an initial Lucene index for the data already present in your database.</p> </div> <div class="paragraph"> <p>Once you have added the above properties and annotations, if you have existing data in the database you will need to trigger an initial batch index of your books. This will rebuild your index to make sure your index and your database is in synch. You can achieve this by using one of the following code snippets (see also <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-batchindex">Rebuilding the whole index</a>):</p> </div> <div class="listingblock"> <div class="title">Using an Hibernate Session to rebuild an index</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">FullTextSession fullTextSession = Search.getFullTextSession(session);&#x000A;fullTextSession.createIndexer().startAndWait();</code></pre> </div> </div> <div class="listingblock"> <div class="title">Using an EntityManager (JPA) to rebuild an index</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(entityManager);&#x000A;fullTextEntityManager.createIndexer().startAndWait();</code></pre> </div> </div> <div class="paragraph"> <p>After executing the above code, you should be able to see a Lucene index under /var/lucene/indexes/example.Book.</p> </div> <div class="paragraph"> <p>The root of the storage path depends on the configuration property hibernate.search.default.indexBase we specified in the configuration step.</p> </div> <div class="paragraph"> <p>You could now inspect this index with <a href="https://github.com/DmitryKey/luke/releases/">Luke</a>. It will help you to understand how Hibernate Search works: Luke allows you to inspect the index contents and structure, similarly to how you would use a SQL console to inspect the working of Hibernate ORM on relational databases.</p> </div> </div> </div> <div class="sect1"> <h2 id="searching"><a class="anchor" href="#searching"></a>Searching</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now we&#8217;ll finally execute a first search. The general approach is to create a Lucene query, either via the Lucene API (see <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-query-lucene-api">Building a Lucene query using the Lucene API</a>) or via the Hibernate Search query DSL (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-query-querydsl">Building a Lucene query with the Hibernate Search query DSL</a>), and then wrap this query into a org.hibernate.Query in order to get all the functionality one is used to from the Hibernate API. Essentially:</p> </div> <div class="ulist"> <ul> <li> <p>Create a Lucene Query (either using Lucene code directly or via the Hibernate Search DSL)</p> </li> <li> <p>Wrap the Lucene Query into an Hibernate Query (org.apache.lucene.search.Query &#8594; org.hibernate.Query)</p> </li> <li> <p>Execute the Hibernate Query</p> </li> </ul> </div> <div class="paragraph"> <p>The following code will prepare a query against the indexed fields, execute it and return a list of Books.</p> </div> <div class="listingblock"> <div class="title">Using JPA to create and execute a search</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">EntityManager em = entityManagerFactory.createEntityManager();&#x000A;FullTextEntityManager fullTextEntityManager =&#x000A;    org.hibernate.search.jpa.Search.getFullTextEntityManager(em);&#x000A;em.getTransaction().begin();&#x000A;&#x000A;<span style="color:#777">// create native Lucene query unsing the query DSL</span>&#x000A;<span style="color:#777">// alternatively you can write the Lucene query using the Lucene query parser</span>&#x000A;<span style="color:#777">// or the Lucene programmatic API. The Hibernate Search DSL is recommended though</span>&#x000A;QueryBuilder qb = fullTextEntityManager.getSearchFactory()&#x000A;    .buildQueryBuilder().forEntity(<span style="color:#0a8;font-weight:bold">Book</span>.class).get();&#x000A;org.apache.lucene.search.Query luceneQuery = qb&#x000A;  .keyword()&#x000A;  .onFields(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">title</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subtitle</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">authors.name</span><span style="color:#710">&quot;</span></span>)&#x000A;  .matching(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Java rocks!</span><span style="color:#710">&quot;</span></span>)&#x000A;  .createQuery();&#x000A;&#x000A;<span style="color:#777">// wrap Lucene query in a javax.persistence.Query</span>&#x000A;javax.persistence.Query jpaQuery =&#x000A;    fullTextEntityManager.createFullTextQuery(luceneQuery, <span style="color:#0a8;font-weight:bold">Book</span>.class);&#x000A;&#x000A;<span style="color:#777">// execute search</span>&#x000A;<span style="color:#0a8;font-weight:bold">List</span> result = jpaQuery.getResultList();&#x000A;&#x000A;em.getTransaction().commit();&#x000A;em.close();</code></pre> </div> </div> <div class="paragraph"> <p>When the Lucene Query is wrapped into an Hibernate or JPA standard Query, all well known methods of this interface are available.</p> </div> </div> </div> <div class="sect1"> <h2 id="introduction-to-full-text"><a class="anchor" href="#introduction-to-full-text"></a>Introduction to Full-Text</h2> <div class="sectionbody"> <div class="paragraph"> <p>Let&#8217;s make things a little more interesting now. Assume that one of your indexed book entities has the title "Refactoring: Improving the Design of Existing Code" and you want to get hits for all of the following queries: "refactor", "refactors", "refactored" and "refactoring". In Lucene this can be achieved by choosing an <em>Analyzer</em> class which applies word stemming during the indexing and during the search process. Hibernate Search offers several ways to configure the analyzer to be used (see <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#analyzer">Default analyzer and analyzer by class</a>):</p> </div> <div class="ulist"> <ul> <li> <p>Setting the hibernate.search.analyzer property in the configuration file. The specified class will then be the default analyzer.</p> </li> <li> <p>Setting the @Analyzer annotation at the entity level.</p> </li> <li> <p>Setting the @Analyzer annotation at the field level.</p> </li> </ul> </div> <div class="paragraph"> <p>When using the @Analyzer annotation one can either specify the fully qualified classname of the analyzer to use or one can refer to an analyzer definition defined by the @AnalyzerDef annotation. In the latter case the Solr analyzer framework with its factories approach is utilized. To find out more about the factory classes available you can either browse the Solr JavaDoc or read the corresponding section on the <a href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">Solr Wiki.</a></p> </div> <div class="paragraph"> <p>In the example below a StandardTokenizerFactory is used followed by two filter factories, LowerCaseFilterFactory and SnowballPorterFilterFactory. The standard tokenizer splits words at punctuation characters and hyphens while keeping email addresses and internet hostnames intact. It is a good general purpose tokenizer. The lowercase filter lowercases the letters in each token whereas the snowball filter finally applies language specific stemming.</p> </div> <div class="paragraph"> <p>Generally, when using the Solr framework you start with a Tokenizer followed by an arbitrary number of filters.</p> </div> <div class="listingblock"> <div class="title">Using @AnalyzerDef and the Solr framework to define and use an analyzer</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Entity</span>&#x000A;<span style="color:#007">@Indexed</span>&#x000A;<span style="color:#007">@AnalyzerDef</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>,&#x000A;  tokenizer = <span style="color:#007">@TokenizerDef</span>(factory = StandardTokenizerFactory.class),&#x000A;  filters = {&#x000A;    <span style="color:#007">@TokenFilterDef</span>(factory = LowerCaseFilterFactory.class),&#x000A;    <span style="color:#007">@TokenFilterDef</span>(factory = SnowballPorterFilterFactory.class, params = {&#x000A;      <span style="color:#007">@Parameter</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">language</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">English</span><span style="color:#710">&quot;</span></span>)&#x000A;    })&#x000A;  })&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#007">@DocumentId</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#007">@Analyzer</span>(definition = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#007">@Analyzer</span>(definition = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@IndexedEmbedded</span>&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index = Index.YES, analyze = Analyze.NO, store = Store.YES)&#x000A;  <span style="color:#007">@DateBridge</span>(resolution = Resolution.DAY)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Book</span>() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Using @AnalyzerDef you define an Analyzer, you still have to apply it to entities and or properties using @Analyzer. Like in the above example the customanalyzer is defined but not applied on the entity: it&#8217;s applied on the title and subtitle properties only.</p> </div> <div class="paragraph"> <p>An analyzer definition is not scoped to the entity, so you can define it on any entity and reuse the definition on other entities.</p> </div> </div> </div> <div class="sect1"> <h2 id="what-s-next"><a class="anchor" href="#what-s-next"></a>What&#8217;s next</h2> <div class="sectionbody"> <div class="paragraph"> <p>The above paragraphs gave you an introduction to Hibernate Search, but it supports many more features.</p> </div> <div class="paragraph"> <p>For example Filters make for a very convenient API to add recurring restrictions, or the Spatial Queries can add restrictions based by distance from coordinates.</p> </div> <div class="paragraph"> <p>The next step after this tutorial is to get more familiar with the overall architecture of Hibernate Search (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-architecture">Architecture</a>) and explore the basic features in more detail. Two topics which were only briefly touched in this tutorial were Analyzer configuration (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#analyzer">Default analyzer and analyzer by class</a>) and field bridges (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-mapping-bridge">Bridges</a>). Both are important features required for more fine-grained indexing. More advanced topics cover clustering (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#jms-backend">JMS Master/Slave back end</a>, <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#infinispan-directories">Infinispan Directory configuration</a>), large index handling (<a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#advanced-features-sharding">Sharding Indexes</a>), <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#spatial">Spatial indexing</a>, <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#query-faceting">Faceting</a>.</p> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row-fluid"> <div class="span3 offset2"> <h4>Projects</h4> <ul> <li> <a href="../../../orm" title="Hibernate ORM">Hibernate ORM</a> </li> <li> <a href="../.." title="Search">Hibernate Search</a> </li> <li> <a href="../../../validator" title="Hibernate Validator">Hibernate Validator</a> </li> <li> <a href="../../../ogm" title="Hibernate OGM">Hibernate OGM</a> </li> <li> <a href="../../../tools" title="Hibernate Tools">Hibernate Tools</a> </li> <li> <a href="../../../others" title="Other projects">Other projects</a> </li> </ul> </div> <div class="span3"> <h4>Follow Us</h4> <ul> <li> <a href="http://in.relation.to" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/hibernate/" title="Twitter">Twitter</a> </li> <li> <a href="https://plus.google.com/112681342290762837955/posts" title="Google+">Google+</a> </li> </ul> </div> <div class="span3"> <h4>Contribute and community</h4> <ul> <li> <a href="../../../community" title="Community resources">Community resources</a> </li> <li> <a href="https://hibernate.atlassian.net" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://access.redhat.com/security/team/contact/" title="Report a security issue">Report a security issue</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="row-fluid"> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.jboss.org/"> <img src="http://static.jboss.org/theme/images/common/jbossbadge.png"> </a> </div> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="../../../javascripts/bootstrap-community.min.js"></script> <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      
                          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      
                          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      
                          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       
      ga('create', 'UA-45270411-1', 'auto');
      ga('send', 'pageview');
      
      </script> </div> </body> </html>
<!DOCTYPE html> <html lang="en"> <head> <title>Migration Guide from Hibernate Search 5.4 to 5.5 - Hibernate Search</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="Sanne Grinovero" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/2.3.1.3/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="../../../../stylesheets/styles.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/images/hibernate/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-logo.png); background-repeat:no-repeat; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 200px; margin: 0px auto; }
      }
    </style> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <div id="subproject"> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div id="logobar"> <div class="dropup"> <a class="tabnav-closed" href="https://www.jboss.org" id="tab">Red Hat</a> <script>
              window.addEventListener('load', function() { renderTabzilla("Hibernate Search","search") }, false);
            </script> </div> <a href="/"> <img src="http://static.jboss.org/hibernate/images/hibernate_logo_whitebkg_200px.png"> </a> </div> <div class="navbar navbar-inverse"> <div class="navbar-inner"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <ul class="nav pull-left"> <li class=""><a href="/orm/">ORM</a></li> <li class="active"><a href="/search/">Search</a></li> <li class=""><a href="/validator/">Validator</a></li> <li class=""><a href="/ogm/">OGM</a></li> <li class=""><a href="/tools/">Tools</a></li> <li class=""><a href="/others/">Others</a></li> </ul> <ul class="nav pull-right"> <li><a href="http://in.relation.to">Blog</a></li> <li class=""><a href="../../../../community">Community</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">Follow Us <b class="caret"></b></a> <ul class="dropdown-menu projectsocialmedia"> <li><a href="https://twitter.com/hibernate"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_twitter.png"></a></li> <li><a href="https://plus.google.com/112681342290762837955/posts"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_googleplus.png"></a></li> </ul> </li> </ul> </div> </div> </div> <script>
          var displayed_releases = [];
          displayed_releases.push('5.8.0.Beta2');
          displayed_releases.push('5.7.1.Final');
          displayed_releases.push('5.6.2.Final');
          displayed_releases.push('5.5.7.Final');
        </script> <div class="row-fluid"> <div class="span2"> <div class="project-menu"> <div class="text-center project-menu-title"> <span class="icon-stack"> <i class="icon-circle icon-stack-base icon-fixed-width"></i> <i class="icon icon-light icon-fixed-width icon-search"></i> </span> </div> <ul class="nav nav-list"> <li class=""> <a href="../../.."> <i class="icon-fixed-width icon-home menu-icon"></i> About </a> </li> <li class=""> <a href="../../../downloads"> <i class="icon-fixed-width icon-cloud-download menu-icon"></i> Downloads </a> </li> <li class="active"> <a href="../.."> <i class="icon-fixed-width icon-book menu-icon"></i> Documentation </a> </li> <li class=""> <a href="../../../tooling"> <i class="icon-fixed-width icon-wrench menu-icon"></i> Tooling </a> </li> <li class=""> <a href="../../../support"> <i class="icon-fixed-width icon-user-md menu-icon"></i> Paid support </a> </li> <li class=""> <a href="../../../faq"> <i class="icon-fixed-width icon-question menu-icon"></i> FAQ </a> </li> <li class=""> <a href="../../../roadmap"> <i class="icon-fixed-width icon-road menu-icon"></i> Roadmap </a> </li> <li class=""> <a href="../../../contribute"> <i class="icon-fixed-width icon-beer menu-icon"></i> Contribute </a> </li> <li class="divider"></li> <li> <a href="https://community.jboss.org/en/hibernate/search"> <i class="icon-fixed-width icon-edit menu-icon"></i> Wiki </a> </li> <li> <a href="https://hibernate.atlassian.net/browse/HSEARCH"> <i class="icon-fixed-width icon-exclamation-sign menu-icon"></i> Issues </a> </li> <li> <a href="https://access.redhat.com/security/team/contact/"> <i class="icon-fixed-width icon-lock menu-icon"></i> Security issue </a> </li> <li> <a href="https://forum.hibernate.org/viewforum.php?f=9"> <i class="icon-fixed-width icon-comments menu-icon"></i> Forum </a> </li> <li> <a href="https://github.com/hibernate/hibernate-search"> <i class="icon-fixed-width icon-code menu-icon"></i> Source code </a> </li> <li> <a href="http://ci.hibernate.org/job/hibernate-search-master/"> <i class="icon-fixed-width icon-stethoscope menu-icon"></i> CI </a> </li> </ul> </div> <hr class="divider"> <div class="license text-center"> Released under the <a href="https://raw.github.com/hibernate/hibernate-search/master/lgpl.txt">LGPL v2.1</a> </div> </div> <div class="span10"> <div class="row-fluid"> <div class="visible-desktop project-title-desktop"> <div class="pull-left"> <h1>Migration Guide from Hibernate Search 5.4 to 5.5</h1> </div> </div> <div class="hidden-desktop"> <div class="project-title-phone text-center"> <div> <h1>Migration Guide from Hibernate Search 5.4 to 5.5</h1> </div> </div> </div> </div> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Here we are helping you migrate your existing Search application to the latest and greatest.</p> </div> </div> <div id="toc" class="toc"> <div id="toctitle">Content</div> <ul class="sectlevel1"> <li><a href="#upgrade-to-search-5-5-x-from-5-4-x">Upgrade to Search 5.5.x from 5.4.x</a> <ul class="sectlevel2"> <li><a href="#requirements">Requirements</a></li> <li><a href="#api-changes">API changes</a></li> <li><a href="#sorting-options">Sorting options</a></li> <li><a href="#sorting-on-the-id-field">Sorting on the id field</a></li> <li><a href="#faceting-on-numeric-fields">Faceting on Numeric Fields</a></li> <li><a href="#null-value-tokens-for-numeric-fields">Null value tokens for numeric fields</a></li> </ul> </li> </ul> </div> </div> <div class="sect1"> <h2 id="upgrade-to-search-5-5-x-from-5-4-x"><a class="anchor" href="#upgrade-to-search-5-5-x-from-5-4-x"></a>Upgrade to Search 5.5.x from 5.4.x</h2> <div class="sectionbody"> <div class="paragraph"> <p>The aim of this guide is to assist you migrating an existing application using any version <code>5.4.x</code> of Hibernate Search to the latest of the <code>5.5.x</code> series. If you&#8217;re looking to migrate different versions see <a href="/search/documentation/migrate">Hibernate Search migration guides</a>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> This document provides pointers for a migration. It refers to Hibernate Search version <code>5.5.0.Final</code>. If you think something is missing or something does not work, please <a href="/community">contact us</a>. </td> </tr> </table> </div> <div class="sect2"> <h3 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h3> <div class="paragraph"> <p>This version of Hibernate Search now requires using <strong>Apache Lucene 5.3.1</strong>.</p> </div> <div class="paragraph"> <p>If you have kept indexes generated by Lucene 3 i.e. haven&#8217;t rebuilt them with Hibernate 5.0 or later, you will get an <code>IndexFormatTooOldException</code>. We strongly encourage you to rebuild you indexes for example with the mass indexer. If you really really cannot do that, try to:</p> </div> <div class="ulist"> <ul> <li> <p>use Lucene&#8217;s <a href="http://lucene.apache.org/core/5_3_0/MIGRATE.html">IndexUpgrader</a></p> </li> <li> <p>carefully update the Hibernate Search mappings in case their default behavior has changed (check the migration guide).</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="api-changes"><a class="anchor" href="#api-changes"></a>API changes</h3> <div class="paragraph"> <p>Method <code>ContainedInMapping#numericField()</code> has been deprecated and is scheduled for removal. Invoke <code>field().numericField()</code> instead.</p> </div> <div class="paragraph"> <p>There were no further relevant API changes within Hibernate Search itself; but Apache Lucene had a <strong>major</strong> upgrade from 4 to 5. So if your code was importing Lucene code directly, be it to provide powerful custom exctensions, or simply to create instances of <code>org.apache.lucene.search.Query</code> you will likely need to follow the Apache Lucene 5 <a href="http://lucene.apache.org/core/5_3_0/MIGRATE.html">migration guide</a>. Also check out the Lucene 5 <a href="http://lucene.apache.org/core/5_3_0/changes/Changes.html">change log</a>.</p> </div> </div> <div class="sect2"> <h3 id="sorting-options"><a class="anchor" href="#sorting-options"></a>Sorting options</h3> <div class="paragraph"> <p>If your code was not precisely matching the Lucene field encoding for sorting options, chances are that with Lucene 4 it appeared to work correctly. Such a mistake will now be detected and result in runtime exceptions! To match the expected field encoding, remember that a field which is indexed as a <code>String</code> will need to have a single term (even after analysis), and a numeric field encoded as an Integer will have to match a <code>SortField.Type.INT</code> when creating an instance of <code>org.apache.lucene.search.SortField</code>, and similarly for other Numeric types: a Long needs to be sorted with <code>SortField.Type.LONG</code>, etc&#8230;&#8203;</p> </div> <div class="paragraph"> <p>Failing to match the correct type will result in exceptions described in depth at <a href="https://hibernate.atlassian.net/browse/HSEARCH-1951">HSEARCH-1951</a>: we hope to be able to improve at least the clarity of such error messages soon.</p> </div> <div class="paragraph"> <p>Lucene 5 allows for more performant sorting if the fields to sort on are known up-front. They then can be mapped via so-called doc value fields. For that purpose Hibernate Search 5.5 provides the new <code>@SortableField</code> annotation and its multi-valued companion <code>@SortableFields</code>. Although the query engine will fallback to the traditional approach of index un-inverting when detecting a sort field not mapped via <code>@SortableField</code>, it is highly recommended to do so for the sake of better runtime performance and less memory consumption. Check out <a href="http://in.relation.to/2015/09/14/sorting-in-hibernate-search-55/">this blog post</a> which covers that topic in detail.</p> </div> </div> <div class="sect2"> <h3 id="sorting-on-the-id-field"><a class="anchor" href="#sorting-on-the-id-field"></a>Sorting on the id field</h3> <div class="paragraph"> <p>If you are using a numeric id, sorting directly on the id field of your document will not work anymore.</p> </div> <div class="paragraph"> <p>You need to specify a different field used specifically for sorting and marked with the <code>@SortableField</code> annotation.</p> </div> </div> <div class="sect2"> <h3 id="faceting-on-numeric-fields"><a class="anchor" href="#faceting-on-numeric-fields"></a>Faceting on Numeric Fields</h3> <div class="paragraph"> <p>Similarly to Sort options, you need now be careful to run the appropriate kind of Faceting Query on each target field. For example a Numeric Facet Query will have to target a field which was indexed exclusively via the matching Numeric type.</p> </div> </div> <div class="sect2"> <h3 id="null-value-tokens-for-numeric-fields"><a class="anchor" href="#null-value-tokens-for-numeric-fields"></a>Null value tokens for numeric fields</h3> <div class="paragraph"> <p>When using <code>@Field(indexNullAs=)</code> to encode some null marker value in the index, the type of the marker is now required to be compatible with all other values which are indexed in that same field. This was problematic for numeric fields, the ones optimised for range queries on numbers, as we would previously allow you to encode a string keyword like 'null': this is no longer allowed, you will have to pick a number to be used to represent the null value, e.g. '-1'.</p> </div> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row-fluid"> <div class="span3 offset2"> <h4>Projects</h4> <ul> <li> <a href="../../../../orm" title="Hibernate ORM">Hibernate ORM</a> </li> <li> <a href="../../.." title="Search">Hibernate Search</a> </li> <li> <a href="../../../../validator" title="Hibernate Validator">Hibernate Validator</a> </li> <li> <a href="../../../../ogm" title="Hibernate OGM">Hibernate OGM</a> </li> <li> <a href="../../../../tools" title="Hibernate Tools">Hibernate Tools</a> </li> <li> <a href="../../../../others" title="Other projects">Other projects</a> </li> </ul> </div> <div class="span3"> <h4>Follow Us</h4> <ul> <li> <a href="http://in.relation.to" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/hibernate/" title="Twitter">Twitter</a> </li> <li> <a href="https://plus.google.com/112681342290762837955/posts" title="Google+">Google+</a> </li> </ul> </div> <div class="span3"> <h4>Contribute and community</h4> <ul> <li> <a href="../../../../community" title="Community resources">Community resources</a> </li> <li> <a href="https://hibernate.atlassian.net" title="Submit a bug">Submit a bug</a> </li> <li> <a href="https://access.redhat.com/security/team/contact/" title="Report a security issue">Report a security issue</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="row-fluid"> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.jboss.org/"> <img src="http://static.jboss.org/theme/images/common/jbossbadge.png"> </a> </div> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="../../../../javascripts/bootstrap-community.min.js"></script> <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      
                          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      
                          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      
                          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       
      ga('create', 'UA-45270411-1', 'auto');
      ga('send', 'pageview');
      
      </script> </div> </body> </html>